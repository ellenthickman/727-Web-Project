---
title: "Exploring Development Indicators through Food Self-Sufficiency"
author: "Ellen Hickman"
date: "Fall 2025"
output: pdf_document
bibliography: ref.bib
---

GitHub Link: <https://github.com/ellenthickman/727-Web-Project>

```{r setup, include = FALSE}
library(xml2)
library(tidyverse)
library(dplyr)
library(rvest)
library(robotstxt)
library(httr)
library(jsonlite)
library(ggplot2)
library(FAOSTAT) # package for FAO Data (local food chain indicator made from Self-Sufficiency inputs)
library(wbstats) # package for World Bank Data
library(WDI)
library(countrycode) # for linking datasets
```

# 1. Introduction:

Small-scale local food chains (eg. farmer's markets, food co-operatives, farm-to-table), particularly in the West, are held to be beneficial towards individual, community, and environmental health as shorter food chains encourage nutrient dense products (eg. produce, meat, eggs, and dairy), support local economies, and reduce climate impact [@jackson2010]. In curiosity whether the benefits to local food production and consumption hold on a *national and global scale*, this project investigates whether national food self-sufficiency (a proxy of local food chains) can support strong societal well-being, or, alternatively, if participation in globalized trade is necessary for health and equity outcomes.

After cleaning the data and addressing outliers, I explore distributions and relationships among variables, revealing non-linear patterns that motivate clustering. Hierarchical and K-Means analysis identifies three distinct “Food System Archetypes,” highlighting groups of countries that differ in health, wealth, and reliance on local versus global food systems. Visualization of cluster patterns and summary statistics allows us to evaluate whether countries can achieve high health outcomes without intensive resource extraction, providing empirical insight into the validity of the De-Growth hypothesis [@jackson2010] in the agricultural sector and economic inequality.

# 2. Data Sources:

Using country-level data for 2021, I combine FAOSTAT measures of food self-sufficiency (SSR) with World Bank indicators of GDP per capita, life expectancy, and income inequality (Gini Index), by using the ISO3 country codes as a common key. Below, I describe the data collection and cleaning process for each dataset.

## 2A. FAO Data: Creating Food Self-Sufficiency Ratio (SSR)

From the FAO Food Balance Sheets (FBS) domain, I collect country-level data on wheat production, imports, and exports for 2021. Wheat is a staple crop globally, making it a suitable proxy for overall food self-sufficiency.

The SSR is calculated as $SSR = \frac{\text{Food Production} \times 100}{\text{Production} + \text{Imports} - \text{Exports}}$, so that essentially it measures the proportion of food consumed that is produced domestically.

-   An SSR \> 100% indicates a net exporter (globalized provider) The country produces more than it eats.
-   SSR \< 100% indicates import dependence (globalized consumer) The country relies on global chains to eat.
-   SSR $\approx$ 100% indicates self-sufficiency (local). The country eats what it grows.

As a taste of who is "local", Table 1. lists the handful of countries (five) that eat the amount of wheat that they grow, with SSR ranging from 90-110.

```{r, include=FALSE}
### 1A. Collect World Bank Country Codes to merge datasets
# Remove non-countries with WB look-up table
library(readr)
country_codes <- read_csv("~/Desktop/727/727 Web Project/wb_countrycodes.csv") %>%
  mutate(
    area_code = sprintf("%03d", Code),
    region = countrycode(sourcevar = ISO3, origin = "iso3c", destination = "region")
  ) %>%
  select(-Code) %>%
  relocate(area_code)
country_codes
```

```{r, include=FALSE}
## 1B. Filter FAO Data
# table(fao_data$element)
# table(fao_data$element_code)
# area_cts = table(fao_data$area)

fao_data_c <- get_faostat_bulk("FBS") %>%
  mutate(
    area_code = area_code__m49_ %>%
      gsub("^'", "", .) %>%       # remove leading apostrophe
      as.integer() %>%
      sprintf("%03d", .)          # pad to 3 digits
  ) %>%
  filter(
    area_code %in% country_codes$area_code,
    year == 2021,
    item == "Wheat and products",
    element %in% c("production", "import_quantity", "export_quantity")) %>%
  select(area_code, area, value, element) %>%
  left_join(
    country_codes %>% select(area_code, region),
    by = "area_code"
  )
fao_data_c
```

```{r, include=FALSE}
## 1C. Clean Data
# Convert to wide format
fao_data_c_w <- fao_data_c %>%
  pivot_wider(
    names_from = element,
    values_from = value
  ) %>%
  rename(
    production       = production,
    import_quantity  = import_quantity,
    export_quantity  = export_quantity
  )

fao_data_c_w <- fao_data_c_w %>%
  left_join(country_codes %>% select(area_code, ISO3, region), by = c("area_code", "region"))
fao_data_c_w 
```

```{r, include=FALSE}
## 1D. Food Self-Sufficiency Ratio (SSR) Calculation
# SSR > 100%: Net Exporter (Globalized Provider). The country produces more than it eats (e.g., Brazil with Soy).
# SSR < 100%: Import Dependent (Globalized Consumer). The country relies on global chains to eat (e.g., Japan, UK).
# SSR ≈ 100%: Self-Sufficient (Local). The country eats what it grows (e.g., Guyana, India for certain grains).

fao_data_c_w$ssr <- fao_data_c_w$production/(fao_data_c_w$production + fao_data_c_w$import_quantity - fao_data_c_w$export_quantity)

fao_data_c_w <- fao_data_c_w %>%
  mutate(
    ssr = production / (production + import_quantity - export_quantity)
  )

fao_data_c_w_ssr <- fao_data_c_w %>% 
  mutate(
    ssr = round((production / (production + import_quantity - export_quantity)) * 100,2)
  )
fao_data_c_w_ssr

table <- fao_data_c_w_ssr %>%
  select(area, ssr)
```

```{r table, echo=FALSE}
# Show select countires with an SSR value between 90 and 110
fao_data_c_w_ssr %>%
  filter(ssr >= 90 & ssr <= 110) %>%
  select(area, ssr) %>%
  arrange(ssr)
```

## 2B. WB Data: Fetching World Bank Indicators

### Income Inequality: Gini Index

Income inequality is a critical development indicator, often linked to social stability and economic health. The Gini Index measures income distribution within a country, where 0 represents perfect equality and 100 indicates maximal inequality. Usually, countries range from a score of 20 (more equal) to 60 (less equal).

The Gini Index data is sporadically reported by the World Bank (<https://data.worldbank.org/indicator/SI.POV.GINI>), as it is comprised of household (HH) income level data (collected by countries' National Statistics Offices). Since there is no regulatory framework on HH income data, I first examine missingness over the years 2000-2023 to determine the most recent year with sufficient data coverage for analysis.

```{r, echo=FALSE}
### Income Inequality: Gini Index (2000-2023) to check for missingness
# wb_cachelist <- wb_cache()
# str(wb_cachelist, max.level = 1)

wb_indicators2000 <- wb_data(
  indicator = "SI.POV.GINI",
  country = "all",
  return_wide = TRUE
) %>%
  select(country, iso3c, date, Gini_Index = SI.POV.GINI) %>%
  filter(
     iso3c %in% country_codes$ISO3,
     date %in% c(2000:2023)
  )
wb_indicators2000

#Missingness by (year) for years 2000-2023
gini_na_year = wb_indicators2000 %>%
  group_by(date) %>%
  summarise(
    na_ct_year   = sum(is.na(Gini_Index)),
    total_n_year = n(),                      # group-specific N
    na_pct_year  = na_ct_year / 193 * 100,
    sample_n_year = n() - na_ct_year
  )

# assuming your tibble is named gini_missing
ggplot(gini_na_year, aes(x = date, y = na_pct_year)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = gini_na_year$date) +
  labs(
    title = "Gini Index Missingness Rate by Year",
    subtitle = "Percent of countries without a Gini observation",
    x = "Year",
    y = "Missingness (%)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(size = 13),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

# Export the plot if needed
ggsave("gini_missingness_by_year.png", width = 10, height = 6)

```

As observed in Figure 1., missingness for the Gini Index is high across the years 200 and 2023, ranging from \~60% missingness to \~80%. The U-shaped curve shows that NSO HH data collection was highest in the years between 2000 and 2023, with the highest amount of missingness at the peaks of the last 20 years. In the present analysis, I select 2021 Gini data since it yields the highest sample size in the most recent (last 5) years.

### WB Data: Additional World Bank Indicators for 2021

I also collect World Bank data for GDP per capita (current USD) and Life Expectancy at Birth (total years) for 2021 to include in the analysis as additional development indicators. GDP per capita is a standard measure of economic prosperity, while life expectancy reflects overall health outcomes in a country.

```{r, include=FALSE}
## WB indicators: gini, gdp, life expectancy
wb_indicators <- wb_data(
  indicator = c("SI.POV.GINI", "NY.GDP.PCAP.CD", "SP.DYN.LE00.IN"),
  country = "all",
  return_wide = TRUE
) %>%
  select(country, iso3c, date, Gini_Index = SI.POV.GINI, gdp = NY.GDP.PCAP.CD, life_expectancy = SP.DYN.LE00.IN) %>%
  filter(
     iso3c %in% country_codes$ISO3,
     date %in% c(2021)
  )
wb_indicators
```

```{r, include=FALSE}
## 4. Join the tables
master_table <- fao_data_c_w_ssr %>%
  left_join(wb_indicators, by = c("ISO3" = "iso3c"))
master_table
```

# 3. Data Exploration

## 3A. Fraction of Missing Information (FMI) by Key Variables

In Table 3., the fraction of missingness for the two key variables of interest: Gini Index and Food Self-Sufficiency Ratio (SSR) is provided over the total number of countries in the world [@un2025].

As you see here, there are high levels of missingness for both Gini Index (approximately 53.37%) and SSR (approximately 20.92%), indicating that a significant portion of countries lack data for these indicators in 2021. This missingness was addressed by restricting the sample to countries with complete data.

```{r, echo=FALSE}
## 5. Check for Missingness in Master Table: Gini Index and SSR
# 5.1 Missingness Summary Table: Gini
gini_summary <- master_table %>%
  summarise(
    variable = "Gini_Index",
    na_count       = sum(is.na(Gini_Index)),
    na_percent     = round(na_count / 193 * 100, 2),
    usable_n       = n() - na_count
  )

# 5.2 Missingness Summary Table: SSR
ssr_summary <- master_table %>%
  summarise(
    variable = "ssr",
    na_count       = sum(is.na(ssr)),
    na_percent     = round(na_count / 193 * 100, 2),
    usable_n       = n() - na_count
  )

# Combine both summaries into one table
na_gini_srr_table <- bind_rows(gini_summary, ssr_summary)
na_gini_srr_table
```

Next, I examined missingness patterns by GDP income group [@wb2025] and by region to see if certain groups of countries were more likely to have missing data for Gini Index or SSR. From Table 4. and Table 5., we can see that lower-income countries and certain regions (e.g., Sub-Saharan Africa) have higher rates of missingness, which may reflect challenges in data collection and reporting in these contexts.

```{r, echo=FALSE}
#6. Missingness by GDP, by WB Income Group Thresholds (https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups)
#6.1 Create Income Group Variable
master_table <- master_table %>%
  mutate(
    income_group = case_when(
      gdp <= 1135                       ~ "Low income",
      gdp > 1135 & gdp <= 4465   ~ "Lower middle income",
      gdp > 4465 & gdp <= 13845  ~ "Upper middle income",
      gdp > 13845                        ~ "High income"
    )
  )

#6.2 Summarise Missingness by GDP Income Group
na_gdp_table <- master_table %>%
  group_by(income_group) %>%
  summarise(
    total_n    = n(),
    na_count   = sum(is.na(Gini_Index) | is.na(ssr)),
    na_percent = round(na_count / total_n * 100, 2),
    usable_n   = total_n - na_count
  ) %>%
  arrange(desc(na_percent)) %>%
  ungroup()

# Create Total Row
gdp_total_row <- master_table %>%
  summarise(
    income_group = "Total",
    total_n    = 193,
    na_count   = sum(is.na(Gini_Index) | is.na(ssr)),
    na_percent = round(na_count / total_n * 100, 2),
    usable_n   = total_n - na_count
  )

# Bind total row to the original table
na_gdp_table <- bind_rows(na_gdp_table, gdp_total_row)

na_gdp_table
```

```{r, echo=FALSE}
#6.7 Summarise Missingness by Region
na_region_table <- master_table %>%
  group_by(region) %>%
  summarise(
    total_n    = n(),
    na_count   = sum(is.na(Gini_Index) | is.na(ssr)),
    na_percent = round(na_count / total_n * 100, 2),
    usable_n   = total_n - na_count
  ) %>%
  arrange(desc(na_percent)) %>%
  ungroup()

# Create Total Row
region_total_row <- master_table %>%
  summarise(
    region = "Total",
    total_n    = 193,
    na_count   = sum(is.na(Gini_Index) | is.na(ssr)),
    na_percent = round(na_count / total_n * 100, 2),
    usable_n   = total_n - na_count
  )

# Bind total row to the original table
na_region_table <- bind_rows(na_region_table, region_total_row)

na_region_table
```

```{r, include=FALSE}
#7. Create Cleaned Master Table (no missingness in key vars)
master_table_clean <- 
  master_table %>%
  drop_na(Gini_Index, ssr)
```

## 3B. Descriptive Statistics

Out of the new sample (n = 60), I examine distributions of the key clustering variables: Gini Index, Food Self-Sufficiency Ratio (SSR), and GDP per capita. Summary statistics and boxplots in Figures 2. 'Boxplot of Food Self-Suffiency Ratio (SSR)' reveal that there is considerable variation in these indicators across countries, with some outliers present (notably Canada with a very high SSR of 1305.29 -- meaning that Canada is a main global exporter of wheat). These descriptive statistics provide context for the subsequent clustering analysis.

```{r, echo=FALSE}
summary(master_table_clean$Gini_Index)
summary(master_table_clean$ssr)
summary(master_table_clean$gdp)

boxplot(master_table_clean$Gini_Index, main = "Boxplot of Gini Index", ylab = "Gini Index")
boxplot(master_table_clean$ssr, main = "Boxplot of Food Self-Sufficiency Ratio (SSR)", ylab = "SSR")
boxplot(master_table_clean$gdp, main = "Boxplot of GDP per Capita", ylab = "GDP per Capita")
```

I chose to drop Canada as an outlier for summary stats and plots (Final n = 59), the descriptive statistics for the clustering variables are summarized in Table 6. below.

```{r, echo=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)

master_table_noCAN <- 
  master_table_clean %>%
  filter(ISO3 != "CAN")

# Compute summary statistics for each variable
slide_table <- master_table_noCAN %>%
  summarise(
    `Life Expectancy (Mean)` = round(mean(life_expectancy),1),
    `Life Expectancy (Median)` = round(median(life_expectancy),1),
    `Life Expectancy (Min)` = round(min(life_expectancy),1),
    `Life Expectancy (Max)` = round(max(life_expectancy),1),
    `Life Expectancy (SD)` = round(sd(life_expectancy),1),
    
    `SSR (Mean)` = round(mean(ssr),1),
    `SSR (Median)` = round(median(ssr),1),
    `SSR (Min)` = round(min(ssr),1),
    `SSR (Max)` = round(max(ssr),1),
    `SSR (SD)` = round(sd(ssr),1),
    
    `Gini Index (Mean)` = round(mean(Gini_Index),1),
    `Gini Index (Median)` = round(median(Gini_Index),1),
    `Gini Index (Min)` = round(min(Gini_Index),1),
    `Gini Index (Max)` = round(max(Gini_Index),1),
    `Gini Index (SD)` = round(sd(Gini_Index),1),
    
    `GDP per Capita (Mean)` = round(mean(gdp),0),
    `GDP per Capita (Median)` = round(median(gdp),0),
    `GDP per Capita (Min)` = round(min(gdp),0),
    `GDP per Capita (Max)` = round(max(gdp),0),
    `GDP per Capita (SD)` = round(sd(gdp),0)
  )

library(tidyr)
# Pivot longer to make a table with variables as rows, stats as columns
slide_table_long <- slide_table %>%
  pivot_longer(cols = everything(),
               names_to = c("Variable", "Statistic"),
               names_sep = " \\(") %>%
  mutate(Statistic = gsub("\\)", "", Statistic)) %>%
  pivot_wider(names_from = Statistic, values_from = value)

# Pretty kable table
slide_table_long %>%
  kable(
    caption = "Descriptive Statistics for Clustering Variables",
    align = "c"
  ) 
```

## 3C. Scatterplot Exploration: SSR vs. Gini Index

In an initial exploration of the relationship between SSR and Gini Index, I created a scatterplot (Figure 5.) to visualize any potential patterns. The plot reveals a non-linear relationship, suggesting that countries with very low SSR (importers) tend to have more variability in income inequality than countries with very high SSR (exporters). Countries with moderate SSR (100) exhibit lower Gini Index values. This observation motivates the use of clustering techniques to identify distinct groups of countries based on these development indicators.

```{r}
## 6. Simple Scatterplot
ggplot(master_table_noCAN, aes(x = ssr, y = Gini_Index)) +
  geom_point(color = "#1f77b4", size = 3, alpha = 0.8) +  # larger, slightly transparent points
  labs(
    title = "Food Self-Sufficiency Ratio vs. Gini Index",
    subtitle = "Initial Exploration of Variables Used in Clustering",
    x = "Food Self-Sufficiency Ratio (SSR)",
    y = "Gini Index"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title = element_text(face = "bold", size = 20),
    plot.subtitle = element_text(size = 14, color = "gray30"),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    panel.grid.major = element_line(color = "gray85"),
    panel.grid.minor = element_blank()
  )

# Export the plot if needed
ggsave("ssr_vs_gini_CAN_scatterplot.png", width = 10, height = 6)
```

# Clustering Analysis

I chose a hierarchical clustering approach to identify groups of countries based on life expectancy, food self-sufficiency ratio (SSR), Gini Index, and GDP per capita. Hierarchical clustering is suitable for this analysis because it handles smaller sample sizes well and provides a visual representation of the clustering process through dendrograms.

```{r, include=FALSE}
# 1. Select variables + scale
df_clust <- master_table_noCAN %>%
  select(country, life_expectancy, ssr, Gini_Index, gdp) %>%
  na.omit()

df_scaled <- scale(df_clust %>% select(-country))
```

```{r, echo=FALSE, warning=FALSE}
library(factoextra)
library(ggplot2)

# Assign country names to rownames for tip labeling
rownames(df_scaled) <- df_clust$country

# Compute the distance and clustering
d <- dist(df_scaled, method = "euclidean")
hc <- hclust(d, method = "ward.D2")
df_clust$hcluster <- factor(cutree(hc, k = 3))

# Pretty dendrogram with rectangles and custom theme
fviz_dend(
  hc,
  k = 3,                   # Number of clusters
  rect = TRUE,             # Draw rectangles for clusters
  rect_border = "steelblue",
  rect_fill = TRUE,
  rect_lty = 2,
  color_labels_by_k = TRUE,
  main = "Hierarchical Clustering Dendrogram",
  sub = NULL,
  xlab = "Country",
  ylab = "Height",
  cex = 0.5,               # Font size of tip labels
  lwd = 0.6,               # Line width
  ggtheme = theme_minimal(base_size = 14) +
            theme(
              plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
              axis.title = element_text(face = "bold", size = 14),
              axis.text = element_text(size = 10)
            )
)
```

The hierarchical clustering dendrogram (Figure 6.) illustrates the grouping of countries based on the selected development indicators. By cutting the dendrogram at three clusters, we can identify distinct groups of countries that share similar profiles in terms of life expectancy, SSR, Gini Index, and GDP per capita.

```{r, echo=FALSE}
library(knitr)
library(kableExtra)

df_clust %>%
  group_by(hcluster) %>%
  summarise(
    `Life Expectancy`         = round(mean(life_expectancy, na.rm=TRUE), 1),
    `Self-Sufficiency Ratio`  = round(mean(ssr, na.rm=TRUE), 1),
    `Gini Index`              = round(mean(Gini_Index, na.rm=TRUE), 1),
    `GDP per Capita (USD)`    = round(mean(gdp, na.rm=TRUE), 0)
  ) %>%
  kable(
    caption = "Hierarchical Cluster Profiles: Mean Values by Cluster",
    align = "c",
    col.names = c("Hier. Cluster", "Life Expectancy", "SSR", "Gini Index", "GDP per Capita")
  ) 
```

The summary table (Table 7.) presents the mean values of life expectancy, SSR, Gini Index, and GDP per capita for each hierarchical cluster. Across all four clustering variables, we observe considerable variation in country profiles, indicating that the clusters represent distinct "Food System Archetypes" with differing development outcomes. In terms of SSR and GDP per capita, we can define countries as follows: - **Cluster 1**: High SSR (globalized exporters) and high GDP per capita. These countries tend to have high life expectancy and low income inequality. - **Cluster 2**: Moderate SSR (self-sufficient/localized wheat food chains) and moderate GDP per capita. These countries exhibit moderate life expectancy and income inequality. - **Cluster 3**: Low SSR (importers) and low GDP per capita. These countries generally have lower life expectancy and higher income inequality.

# 4. Conclusion

The hierarchical clustering analysis reveals three distinct "Food System Archetypes" among countries based on life expectancy, food self-sufficiency ratio (SSR), Gini Index, and GDP per capita. The clusters highlight the varying development outcomes associated with different levels of food self-sufficiency and economic prosperity. The findings support initial concepts regarding the relationship between local food systems in ther terms of; rich globalized exporters, poor globalized importers; and middling localized economies. The evidence that both the richest and the poorest countries rely on globalized trade suggest that global inequality is in part a product of global food chains, natural resource extraction, and imperial global markets.

However, contrary to De-Growth theory [@jackson2010] and societal well-being, the evidence from this exploratory analysis suggests that countries with higher SSR (exporters) tend to have better health and equity outcomes -- rather than localized food chains promoting better health, community, and ecological well-being.

Further research includes explore the causal mechanisms underlying these relationships and consider additional factors such as governance, social policies, and environmental sustainability. Direct suggestions for futher analysis include 1) incoporating longitudinal data to assess changes over time, 2) creating an aggregate of all food products (eg. rice, fruit, vegetables, dairy, meat, etc.) to calcuate an overall SSR, 3) including the different SSRs for varying food groups in the cluster analysis, and 4) expanding the set of development indicators to capture a more holistic view of societal well-being.

